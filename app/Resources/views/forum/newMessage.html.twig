{% extends 'base.html.twig' %}

{% block title %}
    New message
{% endblock title %}

{% block body %}
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">New message</h5>
            </div>
            <form id="send-message-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" class="form-control" id="username" name="name" required="required">
                    </div>
                    <div class="form-group">
                        <label for="category">Category name</label>
                        <input class="form-control" id="category" name="category" required="required">
                    </div>
                    <div class="form-group">
                        <label for="message">Message text</label>
                        <textarea class="form-control" id="message" name="message" required="required" rows="5" cols="80" form="send-message-form"
                        ></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="send-message">Send message</button>
                </div>
            </form>
        </div>
    </div>
{% endblock body %}

{% block javascripts %}
    <script>
        $(document).ready(function () {
            $('#send-message-form').submit(function() {
                let username = $('#username').val();
                let category = $('#category').val();
                let messageText = $('#message').val();
                $.ajax({
                    type: 'GET',
                    url: "{{path('forum_send_message')}}",
                    data:  {
                        name: username,
                        category_name: category,
                        text: messageText,
                    },
                    success: function (response) {
                        if (typeof response.status != "undefined" && response.status != "undefined")
                        {
                            if (response.status == "OK")
                            {
                                if (typeof response.user_id != "undefined" && response.user_id != "undefined" &&
                                    typeof response.category_id != "undefined" && response.category_id != "undefined")
                                {
                                    alert('Message has been added successfully!');
                                    location.href = '{{ path('forum_index') }}';
                                }
                            }
                        }
                    },
                    error: function () {
                        alert('ERROR');
                    }
                });
                return false;
            });
        });
    </script>
{% endblock javascripts %}